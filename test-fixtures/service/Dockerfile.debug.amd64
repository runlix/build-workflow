# Test Dockerfile for service - AMD64 Debug variant
# Uses debug base image (includes debugging symbols/libraries)
# NOTE: Distroless images can only run static binaries, not shell scripts

ARG BASE_IMAGE
ARG BASE_TAG
ARG BASE_DIGEST
ARG APP_VERSION
ARG APP_USER
ARG APP_PORT
ARG DEBUG_ENABLED

FROM ${BASE_IMAGE}:${BASE_TAG}@${BASE_DIGEST}

# Add metadata file with build information
COPY --chmod=0644 <<EOF /app/metadata.json
{
  "app_version": "${APP_VERSION}",
  "arch": "amd64",
  "user": "${APP_USER}",
  "port": "${APP_PORT}",
  "base_image": "${BASE_IMAGE}",
  "base_tag": "${BASE_TAG}",
  "base_digest": "${BASE_DIGEST}",
  "variant": "debug",
  "debug_enabled": "${DEBUG_ENABLED}"
}
EOF

# EXPOSE does not support variable expansion - must use literal port
EXPOSE 8080

# USER does not support variable expansion and distroless only has root and nonroot users
# For production, you should use nonroot: USER 65532:65532
# For this test, we use root (default)

# Distroless images have no shell or entrypoint by default
# In real usage, you would COPY your compiled binary and set it as ENTRYPOINT
# For testing purposes, we don't set an entrypoint (container will exit immediately)
