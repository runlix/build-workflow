# Test Dockerfile for service - Minimal variant (disabled by default)
# Demonstrates a variant that can be toggled with enabled: false
# NOTE: Distroless images can only run static binaries, not shell scripts

ARG BASE_IMAGE
ARG BASE_TAG
ARG BASE_DIGEST
ARG APP_VERSION
ARG APP_USER
ARG MINIMAL_BUILD

FROM ${BASE_IMAGE}:${BASE_TAG}@${BASE_DIGEST}

# Minimal variant - smallest possible image, just metadata
COPY --chmod=0644 <<EOF /app/metadata.json
{
  "app_version": "${APP_VERSION}",
  "arch": "amd64",
  "user": "${APP_USER}",
  "variant": "minimal",
  "minimal_build": "${MINIMAL_BUILD}"
}
EOF

# USER does not support variable expansion and distroless only has root and nonroot users
# For production, you should use nonroot: USER 65532:65532
# For this test, we use root (default)

# Distroless images have no shell or entrypoint by default
# In real usage, you would COPY your compiled binary and set it as ENTRYPOINT
# For testing purposes, we set a dummy CMD so docker create works (it won't actually run)
CMD ["/app/metadata.json"]
