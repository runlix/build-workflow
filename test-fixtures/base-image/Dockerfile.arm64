# Test Dockerfile for base image - ARM64
# This wraps a distroless image and adds minimal customization

ARG UPSTREAM_IMAGE
ARG UPSTREAM_TAG
ARG UPSTREAM_DIGEST

FROM ${UPSTREAM_IMAGE}:${UPSTREAM_TAG}@${UPSTREAM_DIGEST}

# Add a simple test marker file
COPY --chmod=0644 <<EOF /etc/build-info
{
  "arch": "arm64",
  "base_image": "${UPSTREAM_IMAGE}",
  "base_tag": "${UPSTREAM_TAG}",
  "base_digest": "${UPSTREAM_DIGEST}",
  "variant": "standard"
}
EOF

# Test that the base image works
# Distroless images don't have shell, so we can't add much here
# In a real base image, you might add certificates, timezone data, etc.

# Add dummy CMD so docker create works (needed for testing)
CMD ["/etc/build-info"]
