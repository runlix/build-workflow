name: Build on Call

on:
  workflow_call:

jobs:
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.extract.outputs.matrix }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract enabled targets
        id: extract
        run: |
          MATRIX=$(jq '[ .targets[] | select(.enabled == true) ]' VERSION.json)
          echo "matrix=$MATRIX" >> "$GITHUB_OUTPUT"
          echo "Generated matrix:"
          echo "$MATRIX"
  

  build:
    needs: generate-matrix
    runs-on: ubuntu-latest
    strategy:
      matrix:
        target: ${{ fromJson(needs.generate-matrix.outputs.matrix) }}
    steps:
      - name: Print target info
        run: |
          echo "ðŸ”§ Target: ${{ matrix.target.name }}"
          echo "    Arch: ${{ matrix.target.arch }}"
          echo "  Flavor: ${{ matrix.target.flavor }}"
          echo " Stage FROM: ${{ matrix.target.stage_from }}"
          echo "Runtime FROM: ${{ matrix.target.runtime_from }}"
          