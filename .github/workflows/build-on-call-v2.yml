name: Build on Call

on:
  workflow_call:

jobs:
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.extract.outputs.matrix }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Extract enabled targets
        id: extract
        run: |
          MATRIX=$(jq '[ .targets[] | select(.enabled == true) ]' VERSION.json)
          {
            echo 'matrix<<EOF'
            echo "$MATRIX"
            echo 'EOF'
          } >> "$GITHUB_OUTPUT"

  

  build:
    needs: generate-matrix
    runs-on: ubuntu-latest
    strategy:
      matrix:
        target: ${{ fromJson(needs.generate-matrix.outputs.matrix) }}
    steps:
      - name: Print target info
        run: |
          echo "ðŸ”§ Target: ${{ matrix.target.name }}"
          echo "    Arch: ${{ matrix.target.arch }}"
          echo "  Builder Image: ${{ matrix.target.builder.image }}"
          echo "  Builder TAG: ${{ matrix.target.builder.tag }}"
          echo "  Builder Digest: ${{ matrix.target.builder.digest }}"
          echo "  Base Image: ${{ matrix.target.base.image }}"
          echo "  Base TAG: ${{ matrix.target.base.tag }}"
          echo "  Base Digest: ${{ matrix.target.base.digest }}"
          echo "  Dockerfile: ${{ matrix.target.dockerfile }}"
          